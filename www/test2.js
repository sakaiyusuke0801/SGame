// チップマップデモのサンプル

// シーン
let MapScene = sGame.createScene("MapScene");

// シーンで使うリソース
MapScene.setRes(
    sGame.createResouce("res",
        {
            "world": "res/world.png",
            "char": "res/char1.png",
        }
    ));

// シーンで使うデータ
MapScene.setData({
    "charWork": 0,  // 歩き方
    "charDir": 0,   // 方向
});

// キャラクターデモ
let char = sGame.createChipTextuerDemo("charDemo");
char.res = "char";
char.now = 1;
char.size.w = 32;
char.size.h = 32;
char.tile.col = 3;
char.tile.row = 4;

// キャラの更新処理
char.setUpdate(
    function (_scene, gTouchOn, gTouchOnOff, gTouchX, gTouchY, gTouchMoveX, gTouchMoveY, gTouchOffX, gTouchOffY) {
        // 15フレ毎
        if (_scene.frame % 15 == 0) {
            // 歩き方を変える
            // 0⇒2
            if (_scene.data["charWork"] == 0) {
                _scene.data["charWork"] = 2;
            }
            else {
                _scene.data["charWork"] = 0;
            }
        }
        // インデックスを更新
        this.now_idx = ((_scene.data["charDir"] * this.idx_num_x) + _scene.data["charWork"]) + 1;
    }
);

// マップの配列
let mapArray = [17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 16, 11, 11, 11, 11, 11, 11, 11, 11, 15, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 5, 17, 17, 17, 16, 11, 11, 11, 15, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 5, 17, 17, 17, 6, 20, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 5, 17, 17, 17, 6, 20, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 1, 10, 13, 17, 17, 17, 14, 2, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 17, 8, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 5, 17, 17, 16, 11, 12, 15, 8, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 5, 17, 17, 8, 20, 20, 5, 8, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 5, 17, 17, 14, 2, 20, 3, 4, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 3, 11, 11, 11, 4, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 1, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 13, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 3, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 15, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 5, 17, 17, 17, 17, 17, 14, 9, 9, 2, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 3, 11, 11, 11, 11, 17, 17, 17, 17, 14, 9, 9, 9, 9, 9, 2, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 6, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20];
let wallArray = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 11, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 8, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 8, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 8, 0, 0, 1, 8, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 4, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 11, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
let map = sGame.createChipMapDemo("ChipMapDemo", "world", mapArray, wallArray, 20, 20, 2, 10, 25, 35, sGame.width, sGame.height, 0, 0, 0, 0, 1);

// プレイヤーの登録
map.setPlayerDemo(char, 2, 16, 28, 15);
// マップの更新処理
map.setUpdate(
    function (_scene, gTouchOn, gTouchOnOff, gTouchX, gTouchY, gTouchMoveX, gTouchMoveY, gTouchOffX, gTouchOffY) {
        if (gTouchOn) {
            // 右に動かした
            if (gTouchMoveX > 0) {
                // 3ピクセル動く
                this.movePlayerToX(3);
                // 方向を更新
                _scene.data["charDir"] = 2;
            }
            // 左に動かした
            else if (gTouchMoveX < 0) {
                // 3ピクセル動く
                this.movePlayerToX(-3);
                // 方向を更新
                _scene.data["charDir"] = 1;
            }
            // 上に動かした
            if (gTouchMoveY > 0) {
                // 3ピクセル動く
                this.movePlayerToY(3);
                // 方向を更新
                _scene.data["charDir"] = 0;
            }
            // 下に動かした
            else if (gTouchMoveY < 0) {
                // 3ピクセル動く
                this.movePlayerToY(-3);
                // 方向を更新
                _scene.data["charDir"] = 3;
            }
        }
    }
);

// マップデモ追加
//MapScene.addDemo(map);

// キャラデモ追加
MapScene.addDemo(char);

// シーンのプッシュ
sGame.pushScene(MapScene);
